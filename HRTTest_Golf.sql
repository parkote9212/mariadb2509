CREATE TABLE `GolfMember` (
    `MNo` INT PRIMARY KEY AUTO_INCREMENT,
    `MName` VARCHAR(30) NOT NULL,
    `Phone` VARCHAR(13) UNIQUE,
    `JoinDate` DATE NOT NULL,
    `Grade` CHAR(1) CHECK (`Grade` IN ('A', 'B', 'C'))
);

CREATE TABLE `Lesson` (
    `LNo` INT PRIMARY KEY AUTO_INCREMENT, 
    `MNo` INT,
    `Coach` VARCHAR(30) NOT NULL, 
    `StartDate` DATE NOT NULL, 
    `Fee` INT CHECK (`Fee` >= 0), 
    FOREIGN KEY (`MNo`) REFERENCES `GolfMember`(`MNo`) 
);


CREATE TABLE `Usage` (
    `UNo` INT PRIMARY KEY AUTO_INCREMENT, 
    `MNo` INT, 
    `UDate` DATE NOT NULL,
    `Time` INT CHECK (`Time` > 0), 
    `Cost` INT CHECK (`Cost` >= 0), 
    FOREIGN KEY (`MNo`) REFERENCES `GolfMember`(`MNo`) 
);

INSERT INTO GolfMember (MName, Phone, JoinDate, Grade) VALUES
('김철수', '010-1234-5671', '2023-01-15', 'A'),
('이영희', '010-1234-5672', '2023-02-20', 'B'),
('박민준', '010-1234-5673', '2023-03-10', 'C'),
('최서아', '010-1234-5674', '2023-04-05', 'A'),
('정현우', '010-1234-5675', '2023-05-21', 'B'),
('강지민', '010-1234-5676', '2023-06-11', 'B'),
('조은서', '010-1234-5677', '2023-07-30', 'A'),
('윤도현', '010-1234-5678', '2023-08-19', 'C'),
('임하윤', '010-1234-5679', '2023-09-01', 'A'),
('한유진', '010-1234-5680', '2023-10-25', 'B'),
('신지후', '010-1234-5681', '2023-11-12', 'A'),
('서예은', '010-1234-5682', '2023-12-07', 'C'),
('권민서', '010-1234-5683', '2024-01-18', 'B'),
('송준호', '010-1234-5684', '2024-02-22', 'A'),
('오다은', '010-1234-5685', '2024-03-14', 'B'),
('배서준', '010-1234-5686', '2024-04-09', 'A'),
('홍채원', '010-1234-5687', '2024-05-03', 'C'),
('유시우', '010-1234-5688', '2024-06-28', 'B'),
('장아인', '010-1234-5689', '2024-07-17', 'A'),
('황선우', '010-1234-5690', '2024-08-01', 'B');

INSERT INTO Lesson (MNo, Coach, StartDate, Fee) VALUES
(1, '박프로', '2024-01-10', 150000),
(3, '이프로', '2024-01-15', 200000),
(5, '최프로', '2024-02-01', 180000),
(2, '박프로', '2024-02-05', 150000),
(7, '김프로', '2024-02-20', 250000),
(10, '이프로', '2024-03-07', 200000),
(4, '최프로', '2024-03-11', 180000),
(9, '박프로', '2024-04-02', 150000),
(12, '김프로', '2024-04-18', 250000),
(15, '이프로', '2024-05-09', 200000),
(1, '박프로', '2024-05-13', 150000), -- 1번 회원의 두 번째 강습
(18, '최프로', '2024-06-03', 180000),
(20, '김프로', '2024-06-21', 250000),
(6, '이프로', '2024-07-01', 200000),
(8, '최프로', '2024-07-16', 180000),
(11, '박프로', '2024-08-05', 150000),
(14, '김프로', '2024-08-19', 250000),
(17, '이프로', '2024-09-02', 200000),
(19, '최프로', '2024-09-12', 180000),
(13, '김프로', '2024-09-25', 250000);

INSERT INTO `Usage` (MNo, UDate, `Time`, Cost) VALUES
(2, '2024-05-01', 60, 20000),
(5, '2024-05-01', 90, 25000),
(8, '2024-05-02', 120, 30000),
(1, '2024-05-03', 60, 20000),
(11, '2024-05-04', 90, 25000),
(14, '2024-06-05', 60, 20000),
(3, '2024-06-06', 120, 30000),
(7, '2024-06-07', 90, 25000),
(18, '2024-06-08', 60, 20000),
(20, '2024-07-09', 120, 30000),
(4, '2024-07-10', 90, 25000),
(9, '2024-07-11', 60, 20000),
(12, '2024-07-12', 120, 30000),
(16, '2024-08-13', 90, 25000),
(19, '2024-08-14', 60, 20000),
(6, '2024-08-15', 120, 30000),
(10, '2024-09-16', 90, 25000),
(13, '2024-09-17', 60, 20000),
(17, '2024-09-18', 120, 30000),
(15, '2024-09-19', 90, 25000);

-- A등급회원 조회
SELECT Mname '이름', Phone '전화번호', JoinDate '가입일자'
FROM golfmember
WHERE Grade = 'A';

-- 강습비가 250000 이상인 강습 내역을 조회
SELECT * FROM lesson
WHERE (Fee >= 250000);

-- 회원별 총 이용요금 집계
SELECT G.MName '회원명', SUM(U.Cost) `총 요금`
FROM golfmember G
	INNER JOIN `Usage` U
	ON G.MNo = U.MNo
GROUP BY G.MNo;


-- 수정
UPDATE golfmember
SET Grade = 'A'
WHERE MName = '이영희';

-- 삭제
-- foreien으로 연결된 값부터 삭제한다
DELETE FROM `Usage`
WHERE MNo = 3;


DELETE FROM Lesson
WHERE MNo = 3;


DELETE FROM GolfMember
WHERE MNo = 3;

-- 등급별 통계

SELECT
    G.Grade '등급',
    COUNT(DISTINCT G.MNo) `회원 수`,
    AVG(L.Fee) `평균 강습비`,
    SUM(U.Cost) `총 이용요금`
FROM
    GolfMember G
LEFT JOIN
    Lesson L ON G.MNo = L.MNo
LEFT JOIN
    `Usage` U ON G.MNo = U.MNo
GROUP BY
    G.Grade
ORDER BY
    G.Grade;